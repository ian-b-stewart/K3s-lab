# Secure pod configuration
apiVersion: v1
kind: Pod
metadata:
  name: secure-pod
spec:
  # Pod-level security context
  securityContext:
    # Run as non-root user
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000

    # Secure /proc mount
    seccompProfile:
      type: RuntimeDefault

  containers:
    - name: app
      image: nginx:1.25

      # Container-level security context
      securityContext:
        # Cannot escalate privileges
        allowPrivilegeEscalation: false

        # Read-only root filesystem
        readOnlyRootFilesystem: true

        # Drop all capabilities
        capabilities:
          drop:
            - ALL

      # Writable directories via emptyDir
      volumeMounts:
        - name: tmp
          mountPath: /tmp
        - name: cache
          mountPath: /var/cache/nginx
        - name: run
          mountPath: /var/run

      resources:
        requests:
          memory: "64Mi"
          cpu: "50m"
        limits:
          memory: "128Mi"
          cpu: "100m"

  volumes:
    - name: tmp
      emptyDir: {}
    - name: cache
      emptyDir: {}
    - name: run
      emptyDir: {}
